<style lang="less">
</style>
<template>
  <view class="container">
    <view style="background-color:#eaeaea;padding:20rpx 10rpx 0rpx 10rpx">
      <repeat for="{{list}}">
        <view style="width: 365rpx;height: 280rpx;display:inline-block;">
            <view style="padding:10rpx 10rpx 10rpx 10rpx" @tap="tap({{item}})">
              <image style="width: 100%;max-height:260rpx;background-color:#ffffff" mode="aspectFit" src="{{item.images.normal}}" lazy-load="true"></image>
            </view>
        </view>
      </repeat>
    </view>
  </view>
</template>

<script>
  import wepy from 'wepy'

  export default class Index extends wepy.page {
    config = {
      navigationBarTitleText: 'WeDribbble'
    }

    // é¡µé¢æ•°æ®
    data = {
      list: []
    }

    // é¡µé¢æ–¹æ³•
    methods = {
      tap (item) {
        // é€‰ä¸­çš„ä½œå“å­˜ä¸ºå…¨å±€å˜é‡
        this.$parent.globalData.current = item

        // é¡µé¢è·³è½¬
        wepy.navigateTo({
          url: '/pages/shot?id=' + item.id
        })
      }
    }

    //  ç”Ÿå‘½å‘¨æœŸå‡½æ•°
    onShow() {
      // å½“é¡µé¢æ˜¾ç¤ºä¸”æ•°æ®ä¸ºç©ºæ—¶ï¼Œè°ƒç”¨åŠ è½½
      if (this.list.length === 0) {
        // è°ƒç”¨å°ç¨‹åºä¸‹æ‹‰åˆ·æ–° API
        wepy.startPullDownRefresh()
      }
    }

    // å½“å°ç¨‹åºä¸‹æ¥åˆ·æ–°æ—¶è°ƒç”¨è‡ªå®šä¹‰åˆ·æ–°æ–¹æ³•
    onPullDownRefresh() {
      this.reload()
    }

    // è‡ªå®šä¹‰åˆ·æ–°æ–¹æ³•
    async reload() {
      console.log('ç½‘ç»œè¯·æ±‚')
      var res = await wepy.request('https://api.dribbble.com/i1/shots/?&sort=recent&page=1&per_page=16&access_token=858782a9e363c9a5c434f356af378811649a6d376a40ae24c19a561f627b9afa')
      this.list = res.data
      this.$apply()

      // ç½‘ç»œè¯·æ±‚ç»“æŸååœæ­¢ä¸‹æ‹‰åˆ·æ–°
      wepy.stopPullDownRefresh()

      // å¼¹å‡ºæˆåŠŸå°æç¤º
      wepy.showToast({
        icon: 'none',
        title: 'åˆ·æ–°å®Œæˆ ğŸ˜Š',
        duration: 2000
      })
    }
  }
</script>
